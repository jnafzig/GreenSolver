function testresponseintegral( testCase )
    %TEST test that the response integral function correctly integrates the
    % response function
    x = [-1;0;1];
    
    kval = [ ...
      0.000000000000000 + 1.000000000000000i;...
      1.000000000000000 + 0.000000000000000i;...
      1.732050807568877 + 0.000000000000000i;...
      0.000000000000000 + 1.000000000000000i ];

    sol = [ ...
      [0.000000000000000 + 0.000000000000000i -0.183201650281725 + 0.000000000000000i];...
      [1.000000000000000 + 0.000000000000000i  0.001169043727491 + 0.000000000000000i];...
      [0.254162992999763 + 0.055396882653350i  0.075287182572944 - 0.343992447093388i];...
      [0.254162992999763 - 0.055396882653350i  0.075287182572944 + 0.343992447093388i];...
      [0.254162992999763 + 0.031983405112178i  0.075287182572944 - 0.198604131928566i];...
      [0.254162992999763 - 0.031983405112178i  0.075287182572944 + 0.198604131928566i];...
      [0.960210521451162 - 0.000000000000000i  1.000000000000000 + 0.000000000000000i];...
      [-0.183201650281725 - 0.000000000000000i  0.000000000000000 + 0.000000000000000i] ];
 
    Check = responseintegral(x,kval,sol);

    Check1 = integral2(@(x1,x2) response(x1,x2,x,kval,sol),...
                x(1),x(2),x(1),@(x) x,...
                'RelTol',eps,...
                'AbsTol',eps) ...
            + integral2(@(x1,x2) response(x1,x2,x,kval,sol),...
                x(1),x(2),@(x) x,x(2),...
                'RelTol',eps,...
                'AbsTol',eps);

    Check2 = integral2(@(x1,x2) response(x1,x2,x,kval,sol),...
                    x(1),x(2),x(2),x(3),...
                    'RelTol',eps,...
                    'AbsTol',eps);

    testCase.verifyEqual(abs(Check1-Check(2,2)),0,'AbsTol',10*eps);
    testCase.verifyEqual(abs(Check2-Check(3,2)),0,'AbsTol',10*eps);
    
end

